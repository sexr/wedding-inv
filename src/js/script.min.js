const BASE_INVITATION_URL='https://inv.widasari.web.id';document.addEventListener('DOMContentLoaded',()=>{const urlParams=new URLSearchParams(window.location.search);const guestName=urlParams.get('to');let dynamicDescription="Dengan hormat, kami mengundang Anda untuk merayakan resepsi pernikahan Mamat & Duni.";const dearGuestElement=document.getElementById('dear-guest');if(guestName){dearGuestElement.textContent=`Dear: ${decodeURIComponent(guestName)}`;dynamicDescription=`Undangan resepsi pernikahan Mamat & Duni untuk ${decodeURIComponent(guestName)}. Kami mengundang Anda untuk merayakan hari bahagia kami.`}else{dearGuestElement.textContent=`Dear: Tamu Undangan`}
const ogDescriptionMeta=document.querySelector('meta[property="og:description"]');if(ogDescriptionMeta){ogDescriptionMeta.setAttribute('content',dynamicDescription)}
const ogUrlMeta=document.querySelector('meta[property="og:url"]');if(ogUrlMeta){ogUrlMeta.setAttribute('content',window.location.href.split('?')[0])}
const countdownDate=new Date('June 23, 2025 00:00:00').getTime();const x=setInterval(function(){const now=new Date().getTime();const distance=countdownDate-now;const days=Math.floor(distance/(1000*60*60*24));const hours=Math.floor((distance%(1000*60*60*24))/(1000*60*60));const minutes=Math.floor((distance%(1000*60*60))/(1000*60));const seconds=Math.floor((distance%(1000*60))/1000);document.getElementById('days').innerHTML=String(days).padStart(2,'0');document.getElementById('hours').innerHTML=String(hours).padStart(2,'0');document.getElementById('minutes').innerHTML=String(minutes).padStart(2,'0');document.getElementById('seconds').innerHTML=String(seconds).padStart(2,'0');if(distance<0){clearInterval(x);document.getElementById('countdown').innerHTML="<p class='text-2xl'>Resepsi Pernikahan Telah Dimulai!</p>"}},1000);const backgroundMusic=document.getElementById('background-music');const musicToggleButton=document.getElementById('music-toggle-btn');let isMusicPlaying=!1;document.getElementById('open-invitation-btn').addEventListener('click',function(){const coverSection=document.getElementById('cover-section');const bottomBar=document.getElementById('bottom-bar');musicToggleButton.style.opacity='1';musicToggleButton.style.pointerEvents='auto';backgroundMusic.play().then(()=>{backgroundMusic.muted=!1;isMusicPlaying=!0;musicToggleButton.innerHTML='<i class="fas fa-pause"></i>'}).catch(error=>{console.log('Autoplay dicegah atau gagal:',error);backgroundMusic.muted=!0;isMusicPlaying=!1;musicToggleButton.innerHTML='<i class="fas fa-music"></i>'});coverSection.style.opacity='0';setTimeout(()=>{coverSection.style.display='none';document.body.style.overflow='auto';bottomBar.style.opacity='1';bottomBar.style.pointerEvents='auto'},1000)});musicToggleButton.addEventListener('click',()=>{if(isMusicPlaying){backgroundMusic.pause();musicToggleButton.innerHTML='<i class="fas fa-music"></i>'}else{backgroundMusic.play();musicToggleButton.innerHTML='<i class="fas fa-pause"></i>'}
isMusicPlaying=!isMusicPlaying});document.querySelectorAll('.bottom-bar-item').forEach(item=>{item.addEventListener('click',function(e){e.preventDefault();const targetId=this.getAttribute('data-section');const targetSection=document.getElementById(targetId);if(targetSection){targetSection.scrollIntoView({behavior:'smooth'})}})});const API_BASE="https://tzotwxxzdvau.ap-southeast-1.clawcloudrun.com";const wishesForm=document.getElementById('wishes-form');const commentsDisplay=document.getElementById('comments-display');const attendanceCountSpan=document.getElementById('attendance-count');const nameInput=document.getElementById('name');const messageInput=document.getElementById('message');async function fetchComments(){try{const response=await fetch(`${API_BASE}/get_comments`);if(!response.ok)throw new Error(`HTTP error! status: ${response.status}`);const data=await response.json();commentsDisplay.innerHTML='';if(data.comments&&data.comments.length>0){data.comments.forEach(comment=>{const commentDiv=document.createElement('div');commentDiv.classList.add('comment-item','bg-white','bg-opacity-20','backdrop-blur-md','p-4','mb-4','rounded-lg','text-white');commentDiv.innerHTML=`
                        <p class="comment-name font-semibold">${comment.name}</p>
                        <p class="comment-message text-sm italic mt-1">${comment.message}</p>
                    `;commentsDisplay.appendChild(commentDiv)});attendanceCountSpan.textContent=data.count}else{commentsDisplay.innerHTML='<p class="text-gray-400">Belum ada ucapan. Jadilah yang pertama!</p>';attendanceCountSpan.textContent='0'}}catch(error){console.error('Error fetching comments:',error);commentsDisplay.innerHTML='<p class="text-red-300">Gagal memuat ucapan. Silakan coba lagi nanti.</p>';attendanceCountSpan.textContent='-'}}
wishesForm.addEventListener('submit',async(e)=>{e.preventDefault();const name=nameInput.value.trim();const message=messageInput.value.trim();if(!name||!message){alert("Harap isi nama dan ucapan.");return}
try{const response=await fetch(`${API_BASE}/submit_comment`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({name,message})});if(!response.ok)throw new Error(`HTTP error! status: ${response.status}`);const result=await response.json();if(result.status==='success'){wishesForm.reset();showSuccessModal();fetchComments()}else{alert('Gagal mengirim ucapan: '+(result.message||'Error tidak diketahui'))}}catch(error){console.error('Error submitting comment:',error);alert('Terjadi kesalahan saat mengirim ucapan. Silakan coba lagi.')}});fetchComments()});function copyToClipboard(elementId){const textToCopy=document.getElementById(elementId).innerText;const tempInput=document.createElement('textarea');tempInput.value=textToCopy;document.body.appendChild(tempInput);tempInput.select();document.execCommand('copy');document.body.removeChild(tempInput);showCopyModal()}
function showSuccessModal(){const modal=document.getElementById('successModal');modal.classList.remove('hidden')}
document.getElementById('closeModalBtn').addEventListener('click',()=>{document.getElementById('successModal').classList.add('hidden')});document.getElementById('successModal').addEventListener('click',(e)=>{if(e.target.id==='successModal'){document.getElementById('successModal').classList.add('hidden')}});function showCopyModal(){const modal=document.getElementById('copyModal');modal.classList.remove('hidden')}
document.getElementById('closeCopyBtn').addEventListener('click',()=>{document.getElementById('copyModal').classList.add('hidden')});document.getElementById('copyModal').addEventListener('click',(e)=>{if(e.target.id==='copyModal'){document.getElementById('copyModal').classList.add('hidden')}})
